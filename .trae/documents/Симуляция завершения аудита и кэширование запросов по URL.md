## Цели
- Настроить надёжную симуляцию завершения аудита через заданный интервал.
- Кэшировать запрос: если по тому же `url` уже есть аудит со статусом `pending`, возвращать его как «в процессе».
- Обновить клиент: показывать прогресс, выполнять пуллинг статуса, останавливать при `completed/failed`.

## Изменения на сервере
- Файл `app/api/start-audit/route.ts`:
  - Исправить схему валидации: использовать `z.string().email(...)` для `email`.
  - Перед вставкой проверять наличие записи: `audit_requests` с `status='pending'` и тем же `url`. При наличии — вернуть `{ success: true, auditId, status: 'pending' }` без создания новой записи.
  - Для новых задач писать дополнительное поле `simulate_complete_at` (например, `now() + 5s`).
  - Убрать `setTimeout` внутри роутера (ненадёжно в serverless), симуляцию перенести в обработчик статуса.

- Файл `app/api/get-report-status/route.ts`:
  - При `status='pending'` проверять, наступило ли время `simulate_complete_at`. Если да —
    - Сгенерировать мок-нарушения.
    - Обновить запись: `status='completed'`, заполнить `violations`, `risk_level`, `completed_at`.
    - Опционально создать отдельные записи в `violations` таблице.
  - Возвращать актуальный `status`, `violations`, `riskLevel`, `summary`.

- Миграции БД (`supabase/migrations`):
  - Добавить столбец в `audit_requests`: `simulate_complete_at TIMESTAMP WITH TIME ZONE`.
  - Добавить уникальный частичный индекс, предотвращающий дубликаты `pending` по URL:
    - `CREATE UNIQUE INDEX uniq_pending_url ON audit_requests(url) WHERE status = 'pending';`

## Изменения на клиенте
- Файл `app/components/sections/HeroSection.tsx`:
  - После успешного запуска аудита запускать пуллинг `GET /api/get-report-status?id=...` (интервал 2s).
  - Обновлять в UI `status`, а при `completed` показывать `summary`, `riskLevel`, количество `violations` и прекращать пуллинг.
  - Обрабатывать ошибки сети и повторные попытки, выключать кнопку во время отправки.

## Проверка
- Запустить dev-сервер.
- Отправить аудит с новым `url`: сразу получить `pending`; через ~5s — увидеть `completed` и сводку.
- Отправить ещё раз тот же `url`, пока первый в `pending`: получить тот же `auditId` и `pending` без создания новой записи.
- Проверить, что при достижении времени симуляции статус меняется и пуллинг прекращается.

## Примечания по надёжности
- Перенос симуляции из `setTimeout` в `GET /get-report-status` исключает проблемы с жизненным циклом serverless.
- Уникальный частичный индекс гарантирует отсутствие гонок и дубликатов при конкурирующих запросах.
- Логирование ошибок БД и сетевых исключений останется, чтобы облегчить отладку.

Готов выполнить изменения. Подтвердите план — после этого внесу правки в указанные файлы и миграции.